services:
  coredns:
    image: coredns/coredns:1.13.2
    container_name: coredns
    command: -conf /etc/coredns/Corefile -dns.port 53
    ports:
      - "${IPV4:?error}:53:53"
      - "${IPV4:?error}:53:53/udp"
      - "[${IPV6:?error}]:53:53"
      - "[${IPV6:?error}]:53:53/udp"
    configs:
      - source: corefile
        target: /etc/coredns/Corefile
      - source: zone
        target: /etc/coredns/zone

configs:
  corefile:
    content: |
      ${DOMAINNAME?error} {
        log
        errors
      
        file zone
      }
        
      . {
        log
        errors
        forward . 9.9.9.9 1.1.1.1 8.8.8.8
      }
  zone:
    content: |
      $ ORIGIN ${DOMAINNAME?error}.
      $TTL 60
      
      @ IN A ${IPV4:?error}
      @ IN AAAA ${IPV6:?error}
      * IN A ${IPV4:?error}
      * IN AAAA ${IPV6:?error}

