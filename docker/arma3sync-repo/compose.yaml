services:
  nginx:
    container_name: "arma3sync-repo-nginx"
    image: "nginx:1.29"
    pull_policy: "always"
    restart: "unless-stopped"
    security_opt:
      - "no-new-privileges:true"
    volumes:
      - "arma3sync-repo:/usr/share/nginx/html:ro"
    configs:
      - source: "nginx-config"
        target: "/etc/nginx/conf.d/nginx.conf"
    networks:
      - "proxy"
    labels:
      traefik.enable: true
      traefik.http.routers.arma3sync-repo.entrypoints: "websecure-internal,websecure-external"
      traefik.http.routers.arma3sync-repo.rule: "Host(`mods-test.${TRAEFIK_DOMAINNAME_1:?error}`)"
      traefik.http.routers.arma3sync-repo.service: "arma3sync-repo"
      traefik.http.services.arma3sync-repo.loadbalancer.server.port: 80
volumes:
  arma3sync-repo:
    driver: "local"
    driver_opts:
      type: "cifs"
      o: "username=${SMB_USERNAME:?error},password=${SMB_PASSWORD:?error},rw,noperm,file_mode=0777,dir_mode=0777"
      device: "//${SMB_HOST:?error}/${SMB_PATH:?error}"
configs:
  nginx-config:
    content: |
      server {        
        location / {
          autoindex on;
        }
      }
networks:
  proxy:
    external: true
    name: "${TRAEFIK_NETWORK_NAME:-proxy}"